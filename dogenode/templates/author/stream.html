{% extends "user_base.html" %}

{% block body %}

    <script type="text/javascript">
        $(document).ready(function() {
        /* the CSRF stuff is from:
         * https://docs.djangoproject.com/en/1.6/ref/contrib/csrf/#ajax
         */
            function getCookie(name) {
                var cookieValue = null;
                if (document.cookie && document.cookie != '') {
                    var cookies = document.cookie.split(';');
                    for (var i = 0; i < cookies.length; i++) {
                        var cookie = jQuery.trim(cookies[i]);
                        
                        if (cookie.substring(0, name.length + 1) == (name + '=')) {
                            cookieValue = decodeURIComponent(cookie.substring(name.length+1));
                            break;
                        }
                    }
                }
                return cookieValue;
            }
            var csrftoken = getCookie('csrftoken');
            function csrfsafeMethod(method) {
                return (/^(GET|HEAD|OPTIONS|TRACE)$/.test(method));
            }
            $ajaxSetup({
                crossDomain: false,
                beforeSend: function(xhr, settings) {
                    if (!csrfSafeMethod(settings.type)) {
                        xhr.setRequestHeader("X-CSRFToken", csrftoken);
                    }
                }
            });

            /**
             * Generates a GUID string
             * @returns {String} The generated GUID.
             * @example af8a8416-6e18-a307-bd9c-f2c947bbb3aa
             * @author Slavik Melster (slavik@meltser.info),
             *link http://slavik.meltser.info/?p=142
             */
            function generateGUID() {
                function _p8(s) {
                    var p = (Math.random().toString(16)+"000000000").substr(2,8);
                    return s ? "-"  + p.substr(0,4) + "-" + p.substr(4,4): p;
                }
                return _p8() + _p8(true) + _p8(true) + _p8();
            }

             
            // On click of make new post button, send an AJAX PUT request to create post
            function makePost(event) {
                var guid = generateGUID();
                var postData = JSON.stringify();  // TODO : get json2 file 
                $.ajax({
                    type: "PUT",
                    url: "http://127.0.0.1:8000/api/post/" + guid,
                    data: postData,
                    success: function(request) {


                    }
                },
                error: function() {
                    console.log("error");
                }
            });
            return false;
        }

            }

            
            $("#makePost).on("click", makePost);
  
            // make new post guid
            
        






<div class="col-sm-9 col-sm-offset-3 col-md-10 col-md-offset-2 main">
    <div class="row">
        <div class="col-md-12"><p></p></div>
    </div>
    <div class="row">
        <div class="col-md-12">
            <form class="form-horizontal" role="form">
                <div class="panel panel-default">
                  {% csrf_token %}
                  <div class="panel-heading">
                      <h4><strong>Make New Post</strong></h4>
                  </div>
                  <div class="panel-body">
                      <div class="form-group">
                          <label for="title" class="col-sm-2 col-lg-1 control-label">Title:</label>
                          <div class="col-sm-10 col-lg-11">
                              <input type="text" class="form-control" id="title" name="title" required/>
                          </div>
                      </div>
                      <div class="form-group">
                          <label for="description" class="col-sm-2 col-lg-1 control-label" style="overflow: hidden; word-wrap: break-word;">Description:</label>
                          <div class="col-sm-10 col-lg-11">
                              <input type="text" class="form-control" id="description" name="description"/>
                          </div>
                      </div>
                      <div class="form-group">
                          <label for="content" class="col-sm-2 col-lg-1 control-label">Content:</label>
                          <div class="col-sm-10 col-lg-11">
                              <textarea class="form-control" id="content" name="content"
                               placeholder="Make a new post..." required></textarea>
                          </div>
                      </div>
                      <div class="form-group">
                          <label for="categories" class="col-sm-2 col-lg-1 control-label">Categories:</label>
                          <div class="col-sm-10 col-lg-11">
                              <input type="text" class="form-control" id="categories" name="categories" placeholder="Enter categories separated by spaces"/>
                          </div>
                      </div>
                      <div class="form-group">
                          <label for="image" class="col-sm-2 col-lg-1 control-label">Images:</label>
                          <div class="col-sm-10 col-lg-11">
                              <input type="file" id="image" name="image" accept="image/*" multiple="multiple"/>
                              <span class="help-block">CTRL+Click to select multiple files</span>
                          </div>
                      </div>
                  </div>
                  <div class="panel-footer">
                      <div class="form-group" id="privacyOptions">
                          <label for="visibility" class="control-label col-sm-2 col-lg-1">Viewable by:</label>
                          <div class="col-sm-3 col-md-2 col-lg-2">
                            <select id="visibility" name="visibility" class="form-control">
                            {% for option in visibilities %}
                                <option value="{{ option.0 }}">{{ option.1 }}</option>
                            {% endfor %}
                            </select>
                          </div>
                          <label for="visibilityExceptions" class="control-label col-sm-1 col-lg-1" style="text-align: center">and</label>
                          <div class="col-sm-3 col-md-4">
                              <input type="text" class="form-control" name="visibilityExceptions" id="visibilityExceptions"
                               placeholder="Enter names(s) separated by spaces"/>
                          </div>
                      </div>
                      <div class="form-group" id="visibilityOptions">
                      </div>

                      <div class="form-group" id="contentTypeOptions">
                          <label for="contentType" class="col-sm-2 col-lg-1 control-label">Format:</label>
                          <div class="col-sm-3 col-md-2">
                              <select id="contentType" name="content-type" class="form-control">
                              {% for type in contentTypes %}
                                  <option value="{{ type.0 }}">{{ type.1 }}</option>
                              {% endfor %}
                              </select>
                          </div>
                          <div class="col-sm-offset-5 col-sm-1 col-md-offset-6 col-lg-offset-8">
                              <input type="button" id="makePost" value="Post"/>
                          </div>
                      </div>
                  </div>
                </div>
            </form>
        </div>
     </div>
    <div class="row">
        <div class="col-md-12">
            <header>
                <h3>My Stream \o/</h3>
            </header>
        </div>
    </div>
    {% include 'fragments/post_content.html' %}
</div>
{% endblock %}
